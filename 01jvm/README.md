# JVM

## Java 模块化

### 需求

当前没有模块化有以下问题

1. 应用拆分多或少都有问题，多维护成本高，少拆分成本高
2. 故障不隔离，影响不能得到控制，牵一发动全身
3. 升级和迁移成本高

### 好处

1. 可插拔
2. 模块化开发，相互隔离，代码冲突少，影响面少
3. 动态部署
4. 多版本部署
5. 减少资源消耗



### 模块加载

1. 自定义 ClassLoader By 模块，来加载属于本模块内的 class
2. 突破双亲委派，不上报， 设置 overridePackages 包由子类进行加载，不使用父类加载的 class

### 模块卸载

模块卸载需要满足三个条件

1. 模块里的实例对象没有被引用
2. 模块里的 class 没有被引用
3. 类加载器没有被引用

卸载顺序

1. 关闭资源： 连接池，线程池的关闭
2. 关闭容器： ctx.close(）
3. 去掉引用类加载器：去掉模块引用
4. 卸载 JVM 租户

### 模块间隔离

模块化开发需要解决类隔离问题，否则各个模块之间会相互影响。模块之间的隔离有三个层次

1. 类隔离
2. 实例隔离
3. 资源隔离

### 模块间通信

1. 本地调用
2. RPC 调用
3. 深克隆、反射



