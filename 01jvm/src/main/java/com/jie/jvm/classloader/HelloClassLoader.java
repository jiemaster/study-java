package com.jie.jvm.classloader;

import java.lang.reflect.Method;
import java.util.Base64;

/**
 * @author Jie.LJ.Liu
 * @date 2021/9/10 15:21
 */
public class HelloClassLoader extends ClassLoader {

    public static void main(String[] args) throws Exception {
        Class<?> clazz = new HelloClassLoader().loadClass("com.jie.jvm.Hello");
        Object o = clazz.newInstance();
        System.out.println(o);

        Method helloMethod = clazz.getMethod("hello");
        helloMethod.invoke(clazz.newInstance());
    }

    @Override
    protected Class<?> findClass(String name) throws ClassNotFoundException {
        String helloBase64 = "yv66vgAAADQAjgoAHABFCgAHAEYJAEcASAoABwBJCgBKAEsIACoHAEwKAE0ATgcATwoACQBFCgBQAFEKAAkAUggAUwoACQBUCgBNAFUKAFYAVwoAWABZBwBaCgASAFsKAFwAXQoAXgBfBwBgCgAcAGEIAGIKABYAYwoAZABlCgBYAGYHAGcBAAY8aW5pdD4BAAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEAE0xjb20vamllL2p2bS9IZWxsbzsBAARtYWluAQAWKFtMamF2YS9sYW5nL1N0cmluZzspVgEABGFyZ3MBABNbTGphdmEvbGFuZy9TdHJpbmc7AQAQY2xhc3NCaW5hcnlCeXRlcwEAAltCAQAFaGVsbG8BABNnZXRDbGFzc0JpbmFyeUJ5dGVzAQAEKClbQgEAAWUBABVMamF2YS9pby9JT0V4Y2VwdGlvbjsBAAVjbGF6egEAEUxqYXZhL2xhbmcvQ2xhc3M7AQAJY2xhenpOYW1lAQASTGphdmEvbGFuZy9TdHJpbmc7AQALY2xhenpBc1BhdGgBAAtpbnB1dFN0cmVhbQEAFUxqYXZhL2lvL0lucHV0U3RyZWFtOwEADVN0YWNrTWFwVGFibGUHAGgHAGkHAGoHAFoBABRnZXRDbGF6ekJhc2U2NFN0cmluZwEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQARZ2VuZXJhdGVDbGF6ekZpbGUBABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAAFzAQAKZmlsZVdyaXRlcgEAFExqYXZhL2lvL0ZpbGVXcml0ZXI7AQAKRXhjZXB0aW9ucwEAClNvdXJjZUZpbGUBAApIZWxsby5qYXZhDAAdAB4MACsALAcAawwAbABtDAA7ADwHAG4MAG8APgEAEWNvbS9qaWUvanZtL0hlbGxvBwBoDABwADwBABdqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcgcAaQwAcQByDABzAHQBAAYuY2xhc3MMAHUAPAwAdgB3BwB4DAB5AHoHAHsMAHwAfQEAE2phdmEvaW8vSU9FeGNlcHRpb24MAH4AHgcAfwwAgACDBwCEDACFAIYBABJqYXZhL2lvL0ZpbGVXcml0ZXIMAIcAiAEAAS4MAB0APgcAiQwAigCLDACMAI0BABBqYXZhL2xhbmcvT2JqZWN0AQAPamF2YS9sYW5nL0NsYXNzAQAQamF2YS9sYW5nL1N0cmluZwEAE2phdmEvaW8vSW5wdXRTdHJlYW0BABBqYXZhL2xhbmcvU3lzdGVtAQADb3V0AQAVTGphdmEvaW8vUHJpbnRTdHJlYW07AQATamF2YS9pby9QcmludFN0cmVhbQEAB3ByaW50bG4BAAdnZXROYW1lAQAHcmVwbGFjZQEAFihDQylMamF2YS9sYW5nL1N0cmluZzsBAAZhcHBlbmQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsBAAh0b1N0cmluZwEADmdldENsYXNzTG9hZGVyAQAZKClMamF2YS9sYW5nL0NsYXNzTG9hZGVyOwEAFWphdmEvbGFuZy9DbGFzc0xvYWRlcgEAE2dldFJlc291cmNlQXNTdHJlYW0BACkoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2lvL0lucHV0U3RyZWFtOwEAHW9yZy9hcGFjaGUvY29tbW9ucy9pby9JT1V0aWxzAQALdG9CeXRlQXJyYXkBABkoTGphdmEvaW8vSW5wdXRTdHJlYW07KVtCAQAPcHJpbnRTdGFja1RyYWNlAQAQamF2YS91dGlsL0Jhc2U2NAEACmdldEVuY29kZXIBAAdFbmNvZGVyAQAMSW5uZXJDbGFzc2VzAQAcKClMamF2YS91dGlsL0Jhc2U2NCRFbmNvZGVyOwEAGGphdmEvdXRpbC9CYXNlNjQkRW5jb2RlcgEADmVuY29kZVRvU3RyaW5nAQAWKFtCKUxqYXZhL2xhbmcvU3RyaW5nOwEACGdldENsYXNzAQATKClMamF2YS9sYW5nL0NsYXNzOwEAGGphdmEvbmlvL2NoYXJzZXQvQ2hhcnNldAEADmRlZmF1bHRDaGFyc2V0AQAcKClMamF2YS9uaW8vY2hhcnNldC9DaGFyc2V0OwEABXdyaXRlAQAvKFtCTGphdmEvaW8vV3JpdGVyO0xqYXZhL25pby9jaGFyc2V0L0NoYXJzZXQ7KVYAIQAHABwAAAAAAAYAAQAdAB4AAQAfAAAALwABAAEAAAAFKrcAAbEAAAACACAAAAAGAAEAAAAQACEAAAAMAAEAAAAFACIAIwAAAAkAJAAlAAEAHwAAAEoAAgACAAAADrgAAkyyAAO4AAS2AAWxAAAAAgAgAAAADgADAAAAEwAEABUADQAWACEAAAAWAAIAAAAOACYAJwAAAAQACgAoACkAAQABACoAHgABAB8AAAA3AAIAAQAAAAmyAAMSBrYABbEAAAACACAAAAAKAAIAAAAZAAgAGgAhAAAADAABAAAACQAiACMAAAAJACsALAABAB8AAADQAAQABQAAADwSB0sqtgAITLsACVm3AAorEC4QL7YAC7YADBINtgAMtgAOTSq2AA8stgAQTi24ABGwOgQZBLYAEwO8CLAAAQAsADAAMQASAAMAIAAAACIACAAAAB8AAwAgAAgAIQAjACIALAAkADEAJQAzACYAOAApACEAAAA0AAUAMwAFAC0ALgAEAAMAOQAvADAAAAAIADQAMQAyAAEAIwAZADMAMgACACwAEAA0ADUAAwA2AAAAGAAB/wAxAAQHADcHADgHADgHADkAAQcAOgAJADsAPAABAB8AAAAiAAIAAAAAAAq4ABS4AAK2ABWwAAAAAQAgAAAABgABAAAALQAJAD0APgACAB8AAABtAAQAAgAAADG7ABZZuwAJWbcAChIHtgAXtgAItgAMEhi2AAwqtgAMtgAOtwAZTLgAAiu4ABq4ABuxAAAAAgAgAAAADgADAAAAMQAmADIAMAA0ACEAAAAWAAIAAAAxAD8AMgAAACYACwBAAEEAAQBCAAAABAABABIAAgBDAAAAAgBEAIIAAAAKAAEAXgBcAIEACQ==";
        byte[] bytes = Base64.getDecoder().decode(helloBase64);
        return defineClass(name, bytes, 0, bytes.length);
    }
}
